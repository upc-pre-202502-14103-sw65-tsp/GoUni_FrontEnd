<div class="payment-container">
  <h2>Completa tu pago</h2>
  @if (planName) {
    <p class="plan-info">Estás suscribiéndote al: <strong>{{ planName }}</strong></p>
  }

  @if (!paymentSuccess) {
    <form [formGroup]="paymentForm" (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label for="name">Nombre completo</label>
        <input type="text" id="name" formControlName="name" class="form-control">
        @if (paymentForm.get('name')?.invalid && paymentForm.get('name')?.touched) {
          <div class="error">
            Nombre es requerido
          </div>
        }
      </div>

      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" id="email" formControlName="email" class="form-control">
        @if (paymentForm.get('email')?.invalid && paymentForm.get('email')?.touched) {
          <div class="error">
            Email válido es requerido
          </div>
        }
      </div>

      <div class="form-group">
        <label for="amount">Monto (USD)</label>
        <input type="number" id="amount" formControlName="amount" class="form-control" 
               [class.disabled]="planAmount > 0" min="1" step="0.01">
        @if (planAmount > 0) {
          <small class="text-muted">El monto está predefinido por el plan seleccionado</small>
        }
        @if (paymentForm.get('amount')?.invalid && paymentForm.get('amount')?.touched) {
          <div class="error">
            Monto válido es requerido
          </div>
        }
      </div>

      <div class="form-group">
        <label>Información de la tarjeta</label>
        <div id="card-element" class="card-element"></div>
      </div>

      @if (errorMessage) {
        <div class="error-message">
          {{ errorMessage }}
        </div>
      }

      <button type="submit" [disabled]="paymentForm.invalid || isLoading" class="btn btn-primary">
        {{ isLoading ? 'Procesando...' : 'Pagar S/.' + (planAmount || paymentForm.get('amount')?.value) }}
      </button>
    </form>
  } @else {
    <div class="success-message">
      <h3>¡Pago completado con éxito!</h3>
      <p>Tu suscripción al plan <strong>{{ planName }}</strong> ha sido activada.</p>
      <button routerLink="/home" class="btn btn-secondary">Volver al inicio</button>
    </div>
  }
</div>